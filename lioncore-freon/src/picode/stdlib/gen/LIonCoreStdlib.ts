// Generated by the ProjectIt Language Generator.
import { PiNamedElement, PiStdlib, Language } from "@projectit/core";
import { LIonCoreMetaType } from "../../language/gen";
import { projectitConfiguration } from "../../config/ProjectitConfiguration";
import { ListUtil } from "../../utils/gen/ListUtil";

/**
 * Class LIonCoreStdlib provides an entry point for all predefined elements in language LIonCore.
 * It holds all instances of limited concepts as defined in the language definition file.
 *
 * This class uses the singleton pattern to ensure that only one instance of the class is present.
 */
export class LIonCoreStdlib implements PiStdlib {
    private static stdlib: PiStdlib; // the only instance of this class

    /**
     * This method implements the singleton pattern
     */
    public static getInstance(): PiStdlib {
        if (this.stdlib === undefined || this.stdlib === null) {
            this.stdlib = new LIonCoreStdlib();
        }
        return this.stdlib;
    }

    public elements: PiNamedElement[] = []; // the predefined elements of language LIonCore

    /**
     * A private constructor, as demanded by the singleton pattern,
     * in which the list of predefined elements is filled.
     */
    private constructor() {
        for (const lib of projectitConfiguration.customStdLibs) {
            ListUtil.addAllIfNotPresent<PiNamedElement>(this.elements, lib.elements);
        }
    }

    /**
     * Returns the element named 'name', if it can be found in this library.
     * If the element can not be found, 'null' is returned.
     * When 'metatype' is provided, the element is only returned when it is
     * an instance of this metatype.
     * @param name
     * @param metatype
     */
    public find(name: string, metatype?: LIonCoreMetaType): PiNamedElement {
        if (!!name) {
            const possibles = this.elements.filter(elem => elem.name === name);
            if (possibles.length !== 0) {
                if (metatype) {
                    for (const elem of possibles) {
                        if (Language.getInstance().metaConformsToType(elem, metatype)) {
                            return elem;
                        }
                    }
                } else {
                    return possibles[0];
                }
            }
        }
        return null;
    }
}
